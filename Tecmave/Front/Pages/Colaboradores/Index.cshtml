@page
@model Front.Pages.Colaboradores.IndexModel
@{
    Layout = "_Layout";
}

<h2>Colaboradores</h2>

<button id="btnNuevo" class="btn btn-primary mb-3">Nuevo colaborador</button>

<table class="table table-striped" id="tblColaboradores">
    <thead>
        <tr>
            <th>Nombre completo</th>
            <th>Puesto</th>
            <th>Salario</th>
            <th>Estado</th>
            <th>Rol</th>
            <th></th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div class="modal fade" id="modalCrear" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Nuevo colaborador</h5>
            </div>
            <div class="modal-body">

                <input id="nombre" class="form-control mb-2" placeholder="Nombre completo">
                <input id="puesto" class="form-control mb-2" placeholder="Puesto">
                <input id="salario" class="form-control mb-2" placeholder="Salario">

            </div>
            <div class="modal-footer">
                <button id="btnGuardar" class="btn btn-success">Guardar</button>
            </div>
        </div>
    </div>
</div>

<script>
    const api = "@Model.ApiBase/colaboradores";

    function cargar() {
        fetch(api)
            .then(r => r.json())
            .then(data => {
                let rows = "";
                data.forEach(c => {
                    rows += `
                        <tr>
                            <td>${c.nombre}</td>
                            <td>${c.puesto}</td>
                            <td>${c.salario}</td>
                            <td>${c.estado}</td>
                            <td>${c.rol}</td>
                            <td>
                                <a href="/Colaboradores/Editar?id=${c.id_colaborador}" class="btn btn-warning">
                                    Editar
                                </a>
                            </td>
                        </tr>`;
                });
                document.querySelector("#tblColaboradores tbody").innerHTML = rows;
            });
    }

    btnNuevo.onclick = () => new bootstrap.Modal(modalCrear).show();

    btnGuardar.onclick = () => {

        const body = {
            nombre: nombre.value,
            puesto: puesto.value,
            salario: parseFloat(salario.value),
            rol: "Colaborador"
        };

        fetch(api, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        })
        .then(() => {
            cargar();
            bootstrap.Modal.getInstance(modalCrear).hide();
        });
    };

    cargar();
</script>
