@using Microsoft.AspNetCore.Identity
@using Tecmave.Front.Models
@inject SignInManager<Usuario> SignInManager
@inject UserManager<Usuario> UserManager

@{
    var roles = new List<string>();
    Usuario? currentUser = null;

    if (SignInManager.IsSignedIn(User))
    {
        currentUser = await UserManager.GetUserAsync(User);
        if (currentUser != null)
        {
            roles = (await UserManager.GetRolesAsync(currentUser)).ToList();
        }
    }

    // Usar "Admin" como nombre de rol de administrador
    bool isAdmin = roles.Contains("Admin");
    bool isCliente = roles.Contains("Cliente");
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="api-base" content="http://localhost:7096">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - TECMAVE CR</title>

    <link rel="preconnect" href="http://fonts.googleapis.com" />
    <link rel="preconnect" href="http://fonts.gstatic.com" crossorigin />
    <link href="http://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="~/css/styles.css" />
    <link rel="stylesheet" href="~/css/dashboard.css" />
    <link rel="stylesheet" href="~/css/theme-lighten.css" />
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="~/css/brand-red-hard.css" />
    <script src="http://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="~/lib/jquery/jquery.min.js"></script>
    <script src="http://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body data-user-id="@(currentUser?.Id)"
      data-user-name="@(currentUser?.UserName ?? "Usuario")"
      data-is-admin="@(isAdmin.ToString().ToLower())"
      data-is-cliente="@(isCliente.ToString().ToLower())">

    <div class="app">
        <aside class="sidebar">
            <div class="brand">
                <img src="~/img/tecmave_logo_innovacion.jpg" alt="Tecmave" />
                <span>Tecmave</span>
            </div>
            <div class="subtle">Gestión</div>
            <nav class="nav">
                <a asp-page="/Servicios/Index"><i class="fa-solid fa-screwdriver-wrench"></i> Servicios</a>
                <a asp-page="/Agendamiento/Index"><i class="fa-solid fa-calendar-check"></i> Agendamiento</a>
                <a asp-page="/Vehiculos/Crear"><i class="fa-solid fa-car"></i>Mis Vehículos</a>

                @* Bloque de gestión solo visible para Admin *@
                @if (isAdmin)
                {
                    <div class="subtle">Gestión</div>
                    <nav class="nav">
                        <a asp-page="/Index"><i class="fa-solid fa-gauge-high"></i> Panel</a>
                        <a asp-page="/Usuarios/Index"><i class="fa-solid fa-user-group"></i> Usuarios</a>
                        <a asp-page="/Vehiculos/Index"><i class="fa-solid fa-car"></i> Vehículos</a>
                        <a asp-page="/Promociones/Index"><i class="fa-solid fa-user-group"></i> Promociones</a>
                        <a asp-page="/Mantenimientos/Index"><i class="fa-solid fa-user-group"></i> Mantenimientos</a>
                        <a asp-page="/Colaboradores/Index"><i class="fa-solid fa-id-badge"></i> Colaboradores</a>
                        <a asp-page="/Factura/Index"><i class="fa-solid fa-file-invoice-dollar"></i> Factura</a>
                        <a asp-page="/Planillas/Index"><i class="fa-solid fa-file-invoice-dollar"></i> Planillas</a>
                        <a asp-page="/Estadisticas/Index"><i class="fa-solid fa-chart-line"></i> Estadísticas</a>
                    </nav>
                }
            </nav>

            <div class="subtle">Cuenta</div>
            <nav class="nav">
                <a id="login-link" asp-page="/Login"><i class="fa-regular fa-circle-user"></i> Iniciar sesión</a>
                <a id="logout-btn" asp-page="#"><i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión</a>
            </nav>
        </aside>

        <header class="topbar">
            <button class="iconbtn" data-toggle-sidebar><i class="fa-solid fa-bars"></i></button>
            <div id="site-header" class="brand2">
                <img class="logo-xs" src="~/img/tecmave_logo_innovacion.jpg" alt="Tecmave"
                     style="width:20px;height:20px;border-radius:6px;margin-right:6px;" />
                <span>@ViewData["Title"] | TECMAVE CR</span>
            </div>
            <div class="search">
                <input type="search" placeholder="Buscar clientes, placas, servicios…" />
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M21 21l-4.3-4.3M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z" stroke="currentColor" stroke-width="1.6" />
                </svg>
            </div>
            <partial name="_LoginPartial" />
        </header>

        <main class="main">
            @RenderBody()
        </main>
    </div>

    <script src="~/js/dashboard.js"></script>
    <script defer src="~/js/nav-active.js"></script>
    <script defer src="~/js/role-ui.js"></script>
    <script defer src="~/js/carousel-polish.js"></script>
    <script defer src="~/js/app.js"></script>

    <footer class="footer-v2" id="site-footer">
        <div class="footer-v2-main">
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-col">
                        <img src="~/img/tecmave_logo_innovacion.jpg" alt="Tecmave Logo" class="footer-logo" />
                        <p class="footer-slogan">Simply #1 Real Estate Theme</p>
                        <div class="footer-v2-socials">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-pinterest"></i></a>
                            <a href="#"><i class="fab fa-youtube"></i></a>
                            <a href="#"><i class="fas fa-rss"></i></a>
                        </div>
                    </div>
                    <div class="footer-col">
                        <h4>Quick Links</h4>
                        <ul class="footer-list">
                            <li><a href="/Index">Home</a></li>
                            <li><a href="#">List Layout</a></li>
                            <li><a href="/Informacion">Blog</a></li>
                            <li><a href="/Contacto">Contact</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Contact Us</h4>
                        <ul class="footer-list contact-info">
                            <li><i class="fas fa-map-marker-alt"></i> <span>3015 Grand Ave, Coconut Grove, Merrick Way, FL 12345</span></li>
                            <li><i class="fas fa-phone-alt"></i> <span>+123-456-789</span></li>
                            <li><i class="fas fa-envelope"></i> <span>sales@example.com</span></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Remain Updated</h4>
                        <form class="subscribe-form">
                            <input type="email" placeholder="Your email address" />
                            <button type="submit">Sign up</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-v2-bottom">
            <div class="container">
                <p>© 2025 All rights reserved.</p>
                <p>Designed by TECMAVE</p>
            </div>
        </div>
    </footer>

    @RenderSection("Scripts", required: false)
</body>
</html>